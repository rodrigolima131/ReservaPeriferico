

@using System.Security.Claims
@using Microsoft.AspNetCore.Hosting
@inject ThemeService ThemeService
@inject IJSRuntime JSRuntime
@inject UserInfoService UserInfoService
@inject IWebHostEnvironment Environment

<MudNavMenu Class="mt-4">
    <!-- Informações do Usuário -->
    <MudPaper Class="ma-4 pa-3" Elevation="1" Style="background: var(--mud-palette-primary-lighten);">
        <MudStack Spacing="2">
            <MudText Typo="Typo.subtitle2" Style="color: white;">
                <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Small" Class="mr-2" />
                @UserInfoService.GetUserName()
            </MudText>
            <MudText Typo="Typo.caption" Style="color: white;">
                @UserInfoService.GetUserEmail()
            </MudText>
        </MudStack>
    </MudPaper>

    <MudText Typo="Typo.subtitle2" Class="ml-4 mb-2" Color="Color.Primary">Menu</MudText>
    <MudNavLink Href="dashboard" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Dashboard">
        Dashboard
    </MudNavLink>
    <MudNavLink Href="equipes" Icon="@Icons.Material.Filled.Groups">
        Equipes
    </MudNavLink>
    <MudNavLink Href="perifericos" Icon="@Icons.Material.Filled.Computer">
        Periféricos
    </MudNavLink>
    
    <MudText Typo="Typo.subtitle2" Class="ml-4 mb-2 mt-4" Color="Color.Primary">Reservas</MudText>
    <MudNavLink Href="reserva" Icon="@Icons.Material.Filled.Add">
        Nova Reserva
    </MudNavLink>
    <MudNavLink Href="minhas-reservas" Icon="@Icons.Material.Filled.Event">
        Minhas Reservas
    </MudNavLink>
    <MudNavLink Href="gerenciar-reservas" Icon="@Icons.Material.Filled.ManageAccounts">
        Gerenciar Reservas
    </MudNavLink>
    <MudNavLink Href="historico-reservas" Icon="@Icons.Material.Filled.History">
        Histórico de Reservas
    </MudNavLink>
    
    @if (Environment.IsDevelopment())
    {
        <MudText Typo="Typo.subtitle2" Class="ml-4 mb-2 mt-4" Color="Color.Secondary">Desenvolvedor</MudText>
        <MudNavLink Href="/hangfire" Icon="@Icons.Material.Filled.Work" Target="_blank">
            Hangfire Dashboard
        </MudNavLink>
        <MudNavLink Href="parametros" Icon="@Icons.Material.Filled.Settings">
            Parâmetros do Sistema
        </MudNavLink>
    }
    
    <MudDivider Class="my-2" />
    
    <!-- Botão de Alternar Tema -->
    <MudNavLink OnClick="ToggleTheme" Icon="@(ThemeService.IsDarkMode ? Icons.Material.Filled.LightMode : Icons.Material.Filled.DarkMode)" Color="Color.Primary">
        @(ThemeService.IsDarkMode ? "Modo Claro" : "Modo Escuro")
    </MudNavLink>
    
    <!-- Botão de Logout -->
    <MudNavLink Href="/auth/logout" Icon="@Icons.Material.Filled.Logout" Color="Color.Error">
        Sair
    </MudNavLink>
</MudNavMenu>

@code {
    private async Task ToggleTheme()
    {
        ThemeService.ToggleTheme();
        
        // Salvar preferência no localStorage
        try
        {
            var theme = ThemeService.IsDarkMode ? "dark" : "light";
            await JSRuntime.InvokeVoidAsync("themeService.setTheme", theme);
        }
        catch
        {
            // Ignorar erros de localStorage
        }
    }
}


